import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { BarChart3 } from 'lucide-react';
import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
} from 'recharts';
import type { VulnerabilityTrendData } from '@/types/vscan';

interface VulnerabilityTrendChartProps {
  data: VulnerabilityTrendData[];
}

export function VulnerabilityTrendChart({ data }: VulnerabilityTrendChartProps) {
  return (
    <Card className="col-span-8">
      <CardContent className="p-6">
        <CardHeader className="flex flex-row items-center justify-between p-0 mb-6">
          <CardTitle className="text-xl flex items-center gap-2">
            <BarChart3 className="h-5 w-5" />
            Vulnerability Trend
          </CardTitle>
        </CardHeader>
        <div style={{ width: '100%', height: 300 }}>
          <ResponsiveContainer>
            <LineChart data={data} margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
              <XAxis 
                dataKey="date" 
                tickFormatter={(date) => new Date(date).toLocaleDateString()}
              />
              <YAxis />
              <CartesianGrid strokeDasharray="3 3" />
              <Tooltip
                labelFormatter={(label) => new Date(label).toLocaleDateString()}
                formatter={(value, name) => [value, name === 'vulnerabilities' ? 'Total' : name]}
              />
              <Line
                type="monotone"
                dataKey="bySeverity.critical"
                name="Critical"
                stroke="#dc2626"
                strokeWidth={2}
                dot={{ fill: '#dc2626' }}
                activeDot={{ r: 8 }}
              />
              <Line
                type="monotone"
                dataKey="bySeverity.high"
                name="High"
                stroke="#ea580c"
                strokeWidth={2}
                dot={{ fill: '#ea580c' }}
              />
              <Line
                type="monotone"
                dataKey="bySeverity.medium"
                name="Medium"
                stroke="#eab308"
                strokeWidth={2}
                dot={{ fill: '#eab308' }}
              />
              <Line
                type="monotone"
                dataKey="bySeverity.low"
                name="Low"
                stroke="#22c55e"
                strokeWidth={2}
                dot={{ fill: '#22c55e' }}
              />
            </LineChart>
          </ResponsiveContainer>
        </div>
      </CardContent>
    </Card>
  );
}